<div class="container" id="admin-page-devis">
    <div class="row bloc-recherche">
        <div class="container px-5 my-5">
            <h3>Rechercher un dévis</h3>
            <form id="devis-search-Form" method="post" action="/admin/devis/search" data-sb-form-api-token="API_TOKEN">
                <div class="row">
                    <div class="form-group col-md-3">
                        <div class="mb-2">
                            <label class="form-label" for="reference">Référence</label>
                            <input name="com_ref" class="form-control" id="reference" type="text" placeholder="Référence" data-sb-validations="" />
                        </div>
                        <div class="mb-2">
                            <label class="form-label" for="livraison">Livraison</label>
                            <input name="com_adr_liv" class="form-control" id="livraison" type="text" placeholder="Livraison" data-sb-validations="" />
                        </div>
                        <div class="mb-2">
                            <label class="form-label" for="repetition">Répétition</label>
                            <input name="ess_repetition" class="form-control" id="repetition" type="date" placeholder="Répétition" data-sb-validations="" />
                        </div>
                    </div>
                    <div class="form-group col-md-3">
                        <div class="mb-2">
                            <label class="form-label" for="client">Nom</label>
                            <input name="cli_nom" class="form-control" id="client" type="text" placeholder="client" data-sb-validations="" />
                        </div>
                        <div class="mb-2">
                            <label class="form-label" for="prenom">Prénom</label>
                            <input name="cli_prenom" class="form-control" id="prenom" type="text" placeholder="Prénom" data-sb-validations="" />
                        </div>
                    </div>
                    <div class="form-group col-md-3">
                        <div class="mb-2">
                            <label class="form-label" for="refProduits">Réf produits</label>
                            <input name="pro_ref" class="form-control" id="refProduits" type="text" placeholder="Réf produits" data-sb-validations="" />
                        </div>
                        <div class="mb-2">
                            <label class="form-label" for="debut">Début</label>
                            <input name="com_debut_spectacle" class="form-control" id="debut" type="date" placeholder="Début" data-sb-validations="" />
                        </div>
                        <div class="mb-2">
                            <label class="form-label" for="fin">Fin</label>
                            <input name="com_fin_spectacle" class="form-control" id="fin" type="date" placeholder="Fin" data-sb-validations="" />
                        </div>
                    </div>
                    <div class="form-group col-md-3">
                        <div class="mb-2">
                            <label class="form-label" for="structure">Structure</label>
                            <input name="adr_structure" class="form-control" id="structure" type="text" placeholder="Structure" data-sb-validations="" />
                        </div>
                        <div class="mb-2">
                          <label class="form-label" for="total"></label>
                          <select name="stc_id" class="form-select" aria-label="Default select example">
                            <% statut_commandes.forEach(stc => { %>
                              <option value="<%= stc.stc_id %>"><%= stc.stc_libelle %></option>
                            <% }) %>
                          </select>
                        </div>
                    </div>
                    <button class="btn text-white btn-info mt-2">Rechercher</button>
                </div>
            </form>
        </div>
    </div>
    <div id="admin-page-produits" class="row mb-3 table-container">
        <table class="table table-striped" striped>
            <thead>
              <tr>
                <th></th>
                <th scope="col">ID</th>
                <th scope="col">Réference</th>
                <th scope="col">Prénom</th>
                <th scope="col">Nom</th>
                <th scope="col">Structure</th>
                <th scope="col">Date</th>
                <th scope="col">Produit</th>
                <th scope="col">Total</th>
                <th scope="col" class="col-livraison">
                  <div>
                    <h5>Livraison</h5>
                    <div>
                      <p>Répetition</p>
                      <p>Spéctacle</p>
                    </div>
                  </div>
                </th>
                <th scope="col" class="col-spectacle">
                  <div>
                    <h5>Spectacle</h5>
                    <div>
                      <p>Début</p>
                      <p>Fin</p>
                    </div>
                  </div>
                </th>
                <th scope="col">Répetition</th>
                <th scope="col">Etat</th>
                <th scope="col">Actions</th>
              </tr>
            </thead>
            <tbody>
                <% if ((typeof commandes !== 'undefined') && commandes.length > 0) { %>
                    <% commandes.forEach(commande => { %>
                        <tr>
                            <td scope="row">
                                <input
                                  class="form-check-input"
                                  type="checkbox"
                                  value=""
                                  id="flexCheckDefault"
                                />
                            </td>
                            <th><span class="tr-id" data-id="<%= commande.com_id %>" data-panier="<%= commande.pan_id %>"><%= commande.com_id %></span></th>
                            <td><%= commande.com_num %></td>
                            <td><%= commande.Client.cli_prenom %></td>
                            <td><%= commande.Client.cli_nom %></td>
                            <td><%= commande.com_adr_livraison.adr_societe %></td>
                            <td><%= moment(commande.com_date).format('D/MM, YYYY')%> </td>
                            <td class="td-modal-container"><span style="display: inline-block; text-align: center;" data-commande="<%= commande.com_id %>" data-panier="<%= commande.pan_id %>"><%= commande.Panier.Panier_details.length %></span></td>
                            <% let sum = 0 %>
                            <% commande.Panier.Panier_details.forEach(pad => { %>
                              <% sum += pad.pad_ttc %>
                            <% }) %>
                            <td><%= sum %>€</td>
                            <td class="data-livraison">
                              <div>
                                <p><%= commande.Frais_port.Mode_liv_essayage.mle_libelle %></p>
                                <p><%= commande.Frais_port.Mode_liv_spectacle.mls_libelle %></p>
                              </div>
                            </td>
                            <td class="data-spectacle">
                              <div>
                                <p><%= moment(commande.com_debut_spectacle).format('D/MM/YYYY') %></p>
                                <p><%= moment(commande.com_fin_spectacle).format('D/MM/YYYY') %></p>
                              </div>
                            </td>
                            <td><%= moment(commande.Essayages[0].ess_repetition).format('D/MM/YYYY') %></td>
                            <td>
                              <%= commande.Chronologies[0].Statut_commande.stc_libelle %>
                            </td>
                            <td>
                                <div class="d-flex justify-content-between">
                                  <a class="btn btn-primary me-1" title="Prévisualiser" href="/admin/devis/view/<%= commande.com_id %>"><i class="fa-solid fa-pen"></i></a>
                                  <a class="btn btn-primary me-1" href="#" title="Bon de livraison"><i class="fa-solid fa-truck-moving"></i></a>
                                  <a class="btn btn-primary me-1" href="#" title="Bon d'essayage"><i class="fa-solid fa-shirt"></i></a>
                                  <a class="btn btn-primary" href="#" title="Facture"><i class="fa-solid fa-money-bill"></i></a>
                                </div>
                            </td>
                        </tr>
                        <tr class="tr-accordion" id="tr-accordion-<%= commande.com_id %>">
                          <td colspan="14" class="td-body">
                            <div>
                              
                            </div>
                          </td>
                        </tr>
                    <% }) %>
                <% } else { %>
                    <div class="alert alert-primary" role="alert">
                        Il n'y a aucune commande dans votre base des données pour l'instant.
                    </div>
                <% } %>
                
            </tbody>
        </table>
        <div class="cat-pagination">
          <% if (nbrPages > 1) { %>
          <nav>
            <ul class="pagination">
              <li class="page-item">
                <a class="page-link" href="/admin/devis?&page=1">1</a>
              </li>
              <% if (pageActive === 1 || pageActive ===2) { %>
              <li class="page-item">
                <a class="page-link" href="/admin/devis?&page=2">2</a>
              </li>
              <li class="page-item">
                <a class="page-link" href="/admin/devis?&page=3">3</a>
              </li>
              <% } else if (pageActive !== 73)  { %>
              <li class="page-item">
                <a class="page-link" href="/admin/devis?&page=<%= pageActive -1 %>"
                  ><%= pageActive-1 %></a
                >
              </li>
              <li class="page-item">
                <a class="page-link" href="/admin/devis?&page=<%= pageActive %>"
                  ><%= pageActive %></a
                >
              </li>
              <li class="page-item">
                <a class="page-link" href="/admin/devis?&page=<%= pageActive+1 %>"
                  ><%= pageActive+1 %></a
                >
              </li>
              <li class="page-item">
                <a class="page-link" href="/admin/devis?&page=<%= pageActive+2 %>"
                  ><%= pageActive+2 %></a
                >
              </li>
              <li class="page-item">...</li>
              <% } %>
              <li class="page-item">
                <a class="page-link" href="/admin/devis?&page=<%= nbrPages %>"
                  ><%= nbrPages %></a
                >
              </li>
            </ul>
          </nav>
      
          <% } %>
        </div>
    </div>

</div>
<script src="/javascripts/admin/devis.js"></script>